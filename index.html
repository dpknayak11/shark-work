<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Expense Tracker</title>
    <!-- Expense Tracker Using async await try catch then()-->
    <style>
      .heading {
        text-align: center;
        font-size: 25px;
        padding-top: 20px;
      }

      form {
        display: flex;
        flex-direction: column;
        height: 50%;
        width: 50%;
        margin: auto;
        padding: 20px;
      }

      form label {
        font-size: 25px;
      }

      form input {
        font-size: 18px;
        border-radius: 4px;
      }

      form select {
        font-size: 18px;
        border-radius: 8px;
      }

      form button {
        margin-top: 10px;
        font-size: 28px;
        font-weight: bold;
        width: 50%;
        border-radius: 10px;
        border: none;
        cursor: pointer;
        color: black;
        background-color: rgb(131, 141, 138);
      }

      button:hover {
        background-color: rgb(61, 68, 66);
        color: white;
      }

      #listOfItems li {
        margin: 10px 0 10px 0;
        list-style-type: none;
        font-size: x-large;
      }
    </style>
    <link
      rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css"
      integrity="sha384-/Y6pD6FV/Vv2HJnA6t+vslU6fwYXjCFtcEpHbNJ0lyAFsXTsjBbfaDjzALeQsN6M"
      crossorigin="anonymous" />
  </head>
  <body>
    <div class="heading">
      <h1>Expense Tracker</h1>
    </div>
    <form onsubmit="lc(event)">
      <label>Expense Amount : </label>
      <input type="text" name="amount" id="amount" placeholder="Enter Expense Amount" />
      <label>Expense Description : </label>
      <input type="text" name="description" id="description" placeholder="Enter Expense Description" />
      <label>Choose a Category:</label>
      <select name="category" id="category">
        <option>Fuel</option>
        <option>Food</option>
        <option>Movie</option>
        <option>Books</option>
        <option>Etc</option>
      </select>
      <button id="saveBtn">Add Expense</button>
      <ul id="listOfItems"></ul>
    </form>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.3.4/axios.min.js"></script>

    <script>
      // set API endpoint URL
      let api = `https://crudcrud.com/api/e214556d7b6c4dfba78e702644dd1824/appointmentData/`;
      let updatedObj = null;
      // handle form submission event
      async function lc(event) {
        event.preventDefault();
        try {
          const amount = event.target.amount.value;
          const description = event.target.description.value;
          const category = event.target.category.value;
          const obj = { amount, description, category };
          // save user to local storage
          await localStorage.setItem(obj.description, JSON.stringify(obj));
          document.querySelectorAll('input[type="text"]').value = "";
          showUserOnScreen(obj);
          // send POST request to API endpoint
          axios.post(`${api}`, obj);
          alert("New Data upload done!");
        } catch (err) {
          console.log(err);// ReferenceError:
        } 
      }
      // retrieve all users from API endpoint and display on screen
      window.addEventListener("DOMContentLoaded", () => {
        // send GET request to API endpoint
        axios.get(`${api}`)
          .then((res) => {
            console.log(res);
            // display users on screen
            for (let i = 0; i < res.data.length; i++) {
              showUserOnScreen(res.data[i]);
            }
          })
          .catch((err) => console.log(err));
      });
      // display user on screen
      function showUserOnScreen(obj) {
        const ulTag = document.getElementById("listOfItems");
        const liTag = document.createElement("li");
        liTag.textContent = `${obj.amount} - ${obj.description} - ${obj.category} `;
        // create delete button
        const deleteButton = document.createElement("input");
        deleteButton.type = "button";
        deleteButton.value = "Delete";
        deleteButton.className = "btn btn-danger btn-sm float-right delete";
        // delete data from output and local storage
        deleteButton.onclick = async () => {
          try {
            // remove user from local storage
            await localStorage.removeItem(obj.description);
            // send DELETE request to API endpoint
            axios.delete(`${api}${obj._id}`);
            // remove element from screen
            ulTag.removeChild(liTag);
            confirm("are you sure");
          } catch (err) {
            console.log(err);
          }
        };
        // create edit button
        const editButton = document.createElement("input");
        editButton.className = "btn btn-dark btn-sm float-right mr-2";
        editButton.type = "button";
        editButton.value = "Edit";

        // edit data in output and local storage
        editButton.onclick = () => {
          document.getElementById("amount").value = obj.amount;
          document.getElementById("description").value = obj.description;
          document.getElementById("category").value = obj.category;
          document.getElementById("saveBtn").onclick = (event) => {
            try {
              alert("Data updated!");
              event.preventDefault();
              // update user in local storage
              localStorage.removeItem(obj);
              ulTag.removeChild(liTag);
              const updatedamount = document.getElementById("amount").value;
              const updateddescription = document.getElementById("description").value;
              const updatedcategory = document.getElementById("category").value;
              const updatedObj = {
                amount: updatedamount,
                description: updateddescription,
                category: updatedcategory,
              }
              localStorage.setItem(updatedObj, JSON.stringify(updatedObj));
              // send PUT request to API endpoint
              axios.put(`${api}${obj._id}`, updatedObj);
              // update element on screen
              showUserOnScreen(updatedObj);
            } catch (err) {
              console.log(err);
            }
          };
        };
        liTag.appendChild(deleteButton);
        liTag.appendChild(editButton);
        ulTag.appendChild(liTag);
      }
    </script>
  </body>
</html>